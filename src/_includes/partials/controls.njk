<aside
    x-data="{
        themes: {{ themes | jsonToAlpine }},
        activeTheme: 'auto',
        activeProperties: [],
        setTheme(theme) {
            this.activeTheme = theme

            const html = document.firstElementChild
            html.setAttribute('data-theme', theme)
        },
        setThemeProperty(property, theme) {
            const html = document.firstElementChild

            if (theme === 'auto') {
                html.style.removeProperty(property)
                this.activeProperties = this.activeProperties.filter(p => p.property !== property)
            } else {
                value = `var(${property}-${theme})`
                html.style.setProperty(property, value)
                this.updateOrAddActiveProperty(property, theme)
            }
        },
        updateOrAddActiveProperty(property, theme) {
            existingProperty = this.activeProperties.find(p => p.property === property);

            existingProperty ?
                existingProperty.theme = theme :
                this.activeProperties.push({ property, theme });
        },
        getActivePropertyTheme(property) {
            const foundProperty = this.activeProperties.find(p => p.property === property);

            return foundProperty ? foundProperty.theme : 'auto';
        },
        isActiveProperty(property, theme) {
            const foundProperty = this.activeProperties.find(p => p.property === property);

            if (!foundProperty && theme === 'auto') {
                return true;
            }

            return foundProperty && foundProperty.theme === theme;
        },
        toggleStylesheet(layer) {
            const stylesheet = document.getElementById(layer + '-stylesheet')
            stylesheet.toggleAttribute('disabled')
        }
     }"
>
    <div class="sticky top-s-m">
        <div class="switcher">
            <div
                class="stack"
                data-stack-space="tiny"
            >
                <fieldset x-on:change="setTheme($event.target.value)">
                    <legend>
                        theme {% set ref = 'themesTemplate' %} {% set content = '(almost)
                        all style changes are based on a different set of design tokens
                        that are applied via custom properties. design tokens are taken
                        from
                        <a
                            href="https://open-props.style"
                            target="_blank"
                            rel="noopener noreferrer"
                            >open props</a
                        >.' %} {% include "components/tooltip.njk" %}
                    </legend>

                    <div class="stack">
                        {% for theme in themes %}
                        <label>
                            <input type="radio" name="theme" value="{{ theme }}" {% if
                            theme === 'auto' %}checked{% endif %}/>
                            <span>{{ theme }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </fieldset>

                <fieldset x-on:change="toggleStylesheet($event.target.value)">
                    <legend>
                        css layers {% set ref = 'cssLayersTemplate' %} {% set content =
                        'css is applied according to the
                        <a
                            href="https://cube.fyi"
                            target="_blank"
                            rel="noopener noreferrer"
                            >cube css</a
                        >
                        methodology. toggle the checkboxes to see the impact of the
                        different layers.' %} {% include "components/tooltip.njk" %}
                    </legend>
                    <div class="stack">
                        {% for layer in cssLayers %}
                        <label>
                            <input
                                type="checkbox"
                                value="{{ layer }}"
                                checked
                            />
                            <span>{{ layer }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </fieldset>
            </div>

            <div
                class="stack"
                data-stack-space="tiny"
            >
                <fieldset>
                    <legend>display font</legend>

                    {% set name = '--font-display' %} {% include
                    "components/change-property.njk" %}
                </fieldset>
                <fieldset>
                    <legend>brand color</legend>

                    {% set name = '--brand' %} {% include "components/change-property.njk"
                    %}
                </fieldset>
                <fieldset>
                    <legend>accent color</legend>

                    {% set name = '--accent' %} {% include
                    "components/change-property.njk" %}
                </fieldset>
                <fieldset>
                    <legend>border radius</legend>

                    {% set name = '--border-radius' %} {% include
                    "components/change-property.njk" %}
                </fieldset>
            </div>
        </div>
    </div>
</aside>
